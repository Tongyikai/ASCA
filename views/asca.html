<!DOCTYPE html>
<html lang="zh-Hant-TW">
	<head>
		<meta charset="UTF-8">
		<title>äº’åŠ©æœƒPLUS</title>
		<link rel="stylesheet" type="text/css" href="public/stylesheets/asca.css">
	</head>
	<body>
		<div class="navigation_bar">
			
			<div class="navigation_logo">
				<a href="http://google.com">äº’åŠ©æœƒPLUS</a>
			</div>

			<div class="navigation_right">
				<ul>
					<li class="nr_li avatar_Menu">
						<img class="small_Avatar" id="small_Avatar" alt="avatarImg">

						<div class="menu">
							<div class="menu_item">
								<ul>
									<li id= "edit_profile_btn" class="edit_profile">ç·¨è¼¯</li>
									<li>å¥½å‹</li>
									<li>è¨­å®š</li>
									<li>ç™»å‡º</li>
								</ul>
							</div>
						</div>

					</li>
				</ul>
			</div>
		</div>

		<div class="profile" id="container" style="width:360px;float:left">
			<img class="big_Avatar" id="big_Avatar" alt="avatarImg">

			<div class="profile_Details" id="header" style="background-color: white; border-radius: 10px;">
				<table>
					<thead>
						<tr>
							<th><h2>ä»‹ç´¹</h2></th>
							<!-- <th></th> -->
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>å§“æ°</td>
							<td></td>
						</tr>
						<tr>
							<td>åå­—</td>
							<td></td>
						</tr>
						<tr>
							<td>E-mail</td>
							<td></td>
						</tr>
						<tr>
							<td>å‡ºç”Ÿæ—¥æœŸ</td>
							<td></td>
						</tr>
						<tr>
							<td>æ€§åˆ¥</td>
							<td></td>
						</tr>
						<tr>
							<td>ç¾å±…</td>
							<td>é«˜é›„å¸‚</td>
						</tr>
						<tr>
							<td>å®¶é„‰</td>
							<td>é«˜é›„å¸‚</td>
						</tr>
						<tr>
							<td>å¸‚è©±</td>
							<td>07-370-5379</td>
						</tr>
						<tr>
							<td>æ‰‹æ©Ÿ</td>
							<td>0421-803-694</td>
						</tr>
						<tr>
							<td>è‡‰æ›¸</td>
							<td><a href="https://www.facebook.com/tongyikai/">tongyikai</a></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<div id="edit" class="edit">

			<div class="edit_Title">
				<a><h2>ç·¨è¼¯å€‹äººæª”æ¡ˆ</h2></a>
			</div>

			<div class="edit_closeButtonArea">
				<span class="edit_closeButton">&times;</span>
			</div>

			<div class="edit_Content">
				<form id="edit_ContentForm" action="http://127.0.0.1:8888/updateProfile" enctype="multipart/form-data" method="post" onsubmit="return changesToYourProfile()">
					<table>
						<tbody>
							<tr>
								<td style="width:150px">
									<label for="avatar">ä¸Šå‚³é ­åƒ</label>
								</td>
								<td style="width:200px">
									<input type="hidden" id="edit_token" name="token">
									<input type="file" id="edit_uploadAvatar" name="avatar" accept="image/png, image/jpeg" onchange="loadFile(event)">
								</td>
								<td>
									<button type="button" onclick="cancelUploadAvatar()" style="width: 20px;">x</button>
								</td>
							</tr>
							<tr>
								<td>
									<label>å§“æ°</label>
								</td>
								<td>
									<input type="text" id="edit_familyName" name="familyName">
								</td>
							</tr>
							<tr>
								<td>
									<label>åå­—</label>
								</td>
								<td>
									<input type="text" id="edit_givenName" name="givenName">
								</td>
							</tr>
							<tr>
								<td>
									<label>å‡ºç”Ÿæ—¥æœŸ</label>
								</td>
								<td>
									<select id="edit_yearBox" class="year" name="year">
										<option value="year">å¹´</option>
									</select>
									<select id="edit_monthBox" class="month" name="month">
										<option value="month">æœˆ</option>
									</select>
									<select id="edit_dayBox" class="day" name="day">
										<option value="day">æ—¥</option>
									</select><br>
								</td>
							</tr>
							<tr>
								<td>
									<label>æ€§åˆ¥</label>
								</td>
								<td>
									<input class="female" id="edit_female" type="radio" name="gender" value="female" checked>å¥³æ€§
									<input class="male" id="edit_male" type="radio" name="gender" value="male">ç”·æ€§
								</td>
							</tr>
							<tr>
								<td>
									<label>ç¾å±…</label>
								</td>
								<td>
									<select id="edit_currentCity" name="currentCity">
										<option value="livesIn">ç›®å‰å±…ä½åœ°</option>
									</select>
								</td>
							</tr>
							<tr>
								<td>
									<label>å®¶é„‰</label>
								</td>
								<td>
									<select id="edit_hometown" name="hometown">
										<option value="placeOfBirth">å‡ºç”Ÿåœ°</option>
									</select><br>
								</td>
							</tr>
							<tr>
								<td>
									<label>é›»è©±</label>
								</td>
								<td>
									<select id="edit_telephoneAreaCode" name="telephoneAreaCode">
										<option value="telephoneAreaCode">å€ç¢¼</option>
									</select>
									<input type="text" id="edit_telephoneNumber" name="telephoneNumber">
								</td>
							</tr>
							<tr>
								<td>
									<label>æ‰‹æ©Ÿ</label>
								</td>
								<td>
									<input type="text" id="edit_mobileNumber" name="mobileNumber">
								</td>
							</tr>
							<tr>
								<td>
									<label>è‡‰æ›¸</label>
								</td>
								<td>
									<input type="text" id="edit_facebook" style="width: 200px;" name="facebook">
								</td>
							</tr>
						</tbody>
					</table>
				</div>

				<div class="edit_Footer">
					<button class="edit_Update_Button" type="submit">æ›´æ–°</button>
				</div>
			</form>
		</div>

		<div id="footer" style="background-color:#FFA500;clear:both;text-align:center;margin-top:1200px;height:100px;">
			ç‰ˆæ¬Šæ‰€æœ‰ Â© ASCA
		</div>

	<script type="text/javascript" src="public/scripts/checkUserInfor.js"></script>
	<script>
			// äººåƒç›®éŒ„
			let avatarMenu = document.querySelector(".avatar_Menu");
			avatarMenu.addEventListener("click", function() {
				this.classList.toggle("active");
			});

			// ç·¨è¼¯è¦–çª—ï¼Œé–‹å•Ÿ"ç·¨è¼¯è¦–çª—"æŒ‰éˆ•ï¼Œé—œé–‰"ç·¨è¼¯è¦–çª—"æŒ‰éˆ•
			let edit = document.getElementById("edit");
			let editProfileButton = document.getElementById("edit_profile_btn");
			let editCloseButton = document.getElementsByClassName("edit_closeButton")[0];

			editProfileButton.onclick = function() {
				edit.style.display = "block";
			}

			editCloseButton.onclick = function() {
				edit.style.display = "none";
			}

			// é™åˆ¶ä¸Šå‚³åœ–ç‰‡çš„å¤§å°
			const UPLOAD_AVATAR_MAX_SIZE = 1*1024*1024; 
			const ERROR_MESSAGE = "ä¸Šå‚³çš„é™„ä»¶æª”æ¡ˆä¸èƒ½è¶…é 1 Mega Byte";
			let uploadAvatarMaxSizeCorrect = true;
			
			var loadFile = function(event) {
				let uploadAvatar = document.getElementById("edit_uploadAvatar");

				// ä¸Šå‚³çš„æª”æ¡ˆå¦‚æœå¤§æ–¼é™åˆ¶é¡¯ç¤ºè­¦å‘Š
				if (uploadAvatar.files[0].size > UPLOAD_AVATAR_MAX_SIZE) {
					uploadAvatarMaxSizeCorrect = false;
					alert(ERROR_MESSAGE);
				} else {
					uploadAvatarMaxSizeCorrect = true;
				}
			}

			function cancelUploadAvatar() {
				document.getElementById("edit_uploadAvatar").value = "";
				uploadAvatarMaxSizeCorrect = true;
			}

			// å‡ºç”Ÿå¹´æœˆæ—¥åƒæ•¸
			function showYear() {
                let options = "<option>å¹´</option>";
                for (var i = 1900; i <= 2020; i++) {
                    options += ("<option>" + i + "</option>");
                }
                document.getElementById("edit_yearBox").innerHTML = options;
            }

            function showMonth() {
                let options = "<option>æœˆ</option>";
                for (var i = 1; i <= 12; i++) {
                    options += ("<option>" + i + "</option>");
                }
                document.getElementById("edit_monthBox").innerHTML = options;
            }

            function showDay() {
                let options = "<option>æ—¥</option>";
                for (var i = 1; i <= 31; i++) {
                    options += ("<option>" + i + "</option>");
                }
                document.getElementById("edit_dayBox").innerHTML = options;
			}
			showYear();
            showMonth();
			showDay();
			
			// æ‰€æœ‰åŸå¸‚åƒæ•¸
			const CITY = ["å°åŒ—å¸‚", "æ–°åŒ—å¸‚", "åŸºéš†å¸‚", "æ¡ƒåœ’å¸‚", "æ–°ç«¹å¸‚", "æ–°ç«¹ç¸£", "è‹—æ —ç¸£", "å°ä¸­å¸‚", "å½°åŒ–ç¸£", "å—æŠ•ç¸£", "é›²æ—ç¸£", "å˜‰ç¾©å¸‚", "å°å—å¸‚", "é«˜é›„å¸‚", "å±æ±ç¸£", "å®œè˜­ç¸£", "èŠ±è“®ç¸£", "å°æ±ç¸£", "æ¾æ¹–ç¸£", "é‡‘é–€ç¸£", "é€£æ±Ÿç¸£"];
			function showCity() {
				let options = "<option>åŸå¸‚</option>";
				for (var i = 0; i < 21; i++) {
					options += ("<option>" + CITY[i] + "</option>");
				}
				document.getElementById("edit_currentCity").innerHTML = options;
				document.getElementById("edit_hometown").innerHTML = options;
			}
			showCity();

			// å¸‚å…§é›»è©±å€åŸŸåƒæ•¸
			const TELEPHONE_AREA_CODE = ["02", "03", "037", "04", "049", "05", "06", "07", "08", "089", "082", "0826", "0836"];
			function showTelephoneAreaCode() {
				let options = "<option>å€ç¢¼</option>"
				for (var i = 0; i < 13; i++) {
					options += ("<option>" + TELEPHONE_AREA_CODE[i] + "</option>");
				}
				document.getElementById("edit_telephoneAreaCode").innerHTML = options;
			}
			showTelephoneAreaCode();

			// æ‚¨çš„å€‹äººè³‡æ–™æ›´æ”¹
			function changesToYourProfile() {
				let cookieValue = document.cookie.replace(/(?:(?:^|.*;\s*)authorization\s*\=\s*([^;]*).*$)|^.*$/, "$1");
				document.getElementById("edit_token").value = cookieValue;
				
				nameCorrect = true;
				birthdayCorrect = true;
				telephoneNumberCorrect = true;
				mobileNumberCorrect = true;
				facebookCorrect = true;

				let funCheckBlank = checkBlank;
				let funCheckBlankInTheWord = checkBlankInTheWord;
				let funCheckNameLength = checkNameLength;
				let funCheckNameIsChinese = checkNameIsChinese;
				let funCheckDateOfBirth = checkDateOfBirth;
				let funCheckTelephoneNumber = checkTelephoneNumber;
				let funCheckMobileNumber = checkMobileNumber;

				let familyName = document.getElementById("edit_familyName").value;
				let givenName = document.getElementById("edit_givenName").value;
				let year = document.getElementById("edit_yearBox").value;
				let month = document.getElementById("edit_monthBox").value;
				let day = document.getElementById("edit_dayBox").value;
				let gender = document.querySelector('input[name="gender"]:checked').value;
				let currentCity = document.getElementById("edit_currentCity").value;
				let hometown = document.getElementById("edit_hometown").value;
				let telephoneAreaCode = document.getElementById("edit_telephoneAreaCode").value;
				let telephoneNumber = document.getElementById("edit_telephoneNumber").value;
				let mobileNumber = document.getElementById("edit_mobileNumber").value;
				let facebook = document.getElementById("edit_facebook").value;

				// æª¢æŸ¥ä½¿ç”¨è€…è¼¸å…¥çš„è³‡è¨Š
				const ERROR_MESSAGE_1 = "æ–‡å­—ä¸è¦åŒ…å‡½ç©ºç™½å­—ç¬¦";
				const ERROR_MESSAGE_2 = "æ–‡å­—é•·åº¦è¶…é5å€‹å­—";
				const ERROR_MESSAGE_3 = "åªé™è¼¸å…¥ä¸­æ–‡";
				const ERROR_MESSAGE_4 = "å‡ºç”Ÿå¹´æœˆæ—¥ä¸æ˜¯æ­£ç¢ºçš„æ—¥æœŸ";
				const ERROR_MESSAGE_5 = "è«‹è¼¸å…¥å®Œæ•´çš„å‡ºç”Ÿæ—¥æœŸ";
				const ERROR_MESSAGE_6 = "å¸‚è©±ä¸æ­£ç¢º";
				const ERROR_MESSAGE_7 = "è«‹è¼¸å…¥å®Œæ•´çš„é›»è©±å€ç¢¼ + è™Ÿç¢¼";
				const ERROR_MESSAGE_8 = "æ‰‹æ©Ÿè™Ÿç¢¼ä¸æ­£ç¢º";
				const ERROR_MESSAGE_9 = "è‡‰æ›¸é€£æ¥ä¸æ­£ç¢º";

				const YEAR_CHARACTER = "å¹´";
				const MONTH_CHARACTER = "æœˆ";
				const DAY_CHARACTER = "æ—¥";
				const AREA_CODE = "å€ç¢¼";

				if (!funCheckBlank(familyName) || !funCheckBlank(givenName)) {
					if (funCheckBlankInTheWord(familyName) || funCheckBlankInTheWord(givenName)) {
						console.log("æ–‡å­—æœ‰åŒ…å‡½ç©ºç™½å­—ç¬¦");
						alert(ERROR_MESSAGE_1);
						nameCorrect = false;

					} else if (!funCheckNameLength(familyName) || !funCheckNameLength(givenName)) {
						console.log("æ–‡å­—é•·åº¦è¶…é5å€‹å­—");
						alert(ERROR_MESSAGE_2);
						nameCorrect = false;

					} else if (!funCheckNameIsChinese(familyName) || !funCheckNameIsChinese(givenName)) {
						console.log("ä¸æ˜¯ä¸­æ–‡");
						alert(ERROR_MESSAGE_3);
						nameCorrect = false;

					} else {
						console.log("ğŸ‘Œ");
					}
				} else {
					console.log("å§“åæ²’æœ‰è¼¸å…¥ï¼Œæˆ– è¼¸å…¥äº†ç©ºç™½");
				}

				if (year != YEAR_CHARACTER && month != MONTH_CHARACTER && day != DAY_CHARACTER) {
					console.log("è¼¸å…¥æ­£ç¢ºçš„æ ¼å¼ é€²å…¥åˆ¤æ–·æ˜¯å¦æ­£ç¢ºçš„æ—¥æœŸ");
					if (funCheckDateOfBirth(year, month, day)) {
						console.log("å‡ºç”Ÿæ­£ç¢º");
					} else {
						console.log("å‡ºç”Ÿä¸æ˜¯æ­£ç¢ºçš„æ—¥æœŸ");
						alert(ERROR_MESSAGE_4);
						birthdayCorrect = false;

					}
				} else if (year == YEAR_CHARACTER && month == MONTH_CHARACTER && day == DAY_CHARACTER) {
					console.log("å‡ºç”Ÿæ²’æœ‰é¸, ä¸ä¿®æ”¹");
				} else {
					console.log("è«‹è¼¸å…¥å®Œæ•´çš„å‡ºç”Ÿæ—¥æœŸ");
					alert(ERROR_MESSAGE_5);
					birthdayCorrect = false;
				}

				if (telephoneAreaCode != AREA_CODE || !funCheckBlank(telephoneNumber)) {
					if (telephoneAreaCode != AREA_CODE && !funCheckBlank(telephoneNumber)) {
						if (funCheckTelephoneNumber(telephoneNumber)) {
							console.log("å¸‚è©±OK");
						} else {
							console.log("å¸‚è©±ä¸æ­£ç¢º");
							alert(ERROR_MESSAGE_6);
							telephoneNumberCorrect = false;
						}
					} else {
						alert(ERROR_MESSAGE_7);
						telephoneNumberCorrect = false;
					}
					
				} else {
					console.log("å¸‚è©± ä¸ä¿®æ”¹");
				}

				if (!funCheckBlank(mobileNumber)) {
					if (!funCheckMobileNumber(mobileNumber)) {
						alert(ERROR_MESSAGE_8);
						mobileNumberCorrect = false;
					}
				}

				if (!funCheckBlank(facebook)) {
					if (funCheckBlankInTheWord(facebook) || facebook.length > 50) {
						alert(ERROR_MESSAGE_9);
						facebookCorrect = false;
					}
				}

				if (uploadAvatarMaxSizeCorrect && nameCorrect && birthdayCorrect && telephoneNumberCorrect && mobileNumberCorrect && facebookCorrect) {
					alert("å¯ä»¥æäº¤");
					return true;

				} else {
					alert("ä¸è¡Œæäº¤");
					return false;
				}
			}

			let funGetProfileData = getProfileData;
			funGetProfileData();

	</script>
	</body>
</html>